<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <title>Columbia River Gorge Wineries Map</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Montserrat', sans-serif;
        }
        
        #map {
            height: 100%;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
        }
        
        .loading-message, .error-message {
            text-align: center;
            padding: 20px;
            color: #696969;
            font-size: 16px;
        }
        
        .error-message {
            color: #d32f2f;
        }
        
        .wine-icon {
            width: 28px;
            height: 28px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .wine-icon:hover {
            transform: scale(1.1);
        }
        
        .gm-style-iw {
            font-family: 'Montserrat', sans-serif !important;
        }
        
        .info-window {
            padding: 4px 6px;
            font-size: 14px;
            line-height: 1.3;
            min-width: 180px;
        }
        
        .info-window strong {
            font-size: 14px;
            color: #333;
            display: block;
            margin-bottom: 2px;
        }
        
        .info-window a {
            color: #0066cc;
            text-decoration: none;
            display: block;
            padding: 1px 0;
        }
        
        .info-window a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .gm-bundled-control {
                margin: 10px !important;
            }
        }
    </style>
</head>
<body>
    <div id="map">
        <div class="loading-message">Loading map...</div>
    </div>

    <script>
        function isAppleDevice() {
            return /iPhone|iPad|iPod|Macintosh/.test(navigator.userAgent);
        }

        function getMapUrl(address, name) {
            const query = encodeURIComponent(address || name);
            if (isAppleDevice()) {
                return `https://maps.apple.com/?q=${query}`;
            } else {
                return `https://www.google.com/maps/search/?api=1&query=${query}`;
            }
        }

        function initMap() {
            try {
                document.getElementById('map').innerHTML = '';
                
                const map = new google.maps.Map(document.getElementById("map"), {
                    mapId: "a590d6c102a9d70631fc7fae",
                    mapTypeId: "roadmap",
                    zoom: 11,
                    tilt: 0,
                    heading: 0,
                    gestureHandling: "greedy",
                    scrollwheel: true,
                    zoomControl: true,
                    fullscreenControl: true,
                    mapTypeControl: false,
                    streetViewControl: false,
                    styles: [
                        {
                            featureType: "poi",
                            elementType: "labels",
                            stylers: [{ visibility: "off" }]
                        },
                        {
                            featureType: "transit",
                            elementType: "labels",
                            stylers: [{ visibility: "off" }]
                        }
                    ]
                });

                const wineries = [
                    { name: "Analemma Wines", lat: 45.6841, lng: -121.4037, url: "https://analemmawines.com", address: "1710 1st St, Mosier, OR 97040", phone: "541-478-2873" },
                    { name: "AniChe Cellars", lat: 45.7283, lng: -121.5349, url: "https://anichecellars.com", address: "71 Little Buck Creek Rd, Underwood, WA 98651", phone: "360-624-6531" },
                    { name: "Cascade Cliffs Vineyard & Winery", lat: 45.6795, lng: -121.5215, url: "https://cascadecliffs.com", address: "211 Oak St, Hood River, OR 97031", phone: "541-436-4215" },
                    { name: "Cathedral Ridge Winery", lat: 45.7156, lng: -121.5450, url: "https://cathedralridgewinery.com", address: "4200 Post Canyon Dr, Hood River, OR 97031", phone: "800-516-8710" },
                    { name: "COR Cellars", lat: 45.6889, lng: -121.3033, url: "https://www.corcellars.com", address: "151 Old Highway 8, Lyle, WA 98635", phone: "509-365-2744" },
                    { name: "Double Strand Wine", lat: 45.6733, lng: -121.4065, url: "https://doublestrandwine.com", address: "953 Quartz Dr, Mosier, OR 97040", phone: "" },
                    { name: "Estelbrook Farms & Vineyard", lat: 45.7259, lng: -121.4840, url: "https://www.estelbrook.com", address: "3640 Post Canyon Dr, Hood River, OR 97031", phone: "" },
                    { name: "Hawkins Cellars", lat: 45.7290, lng: -121.5358, url: "https://hawkinscellars.com", address: "92 Little Buck Creek Rd, Underwood, WA 98651", phone: "" },
                    { name: "Hiyu Wine Farm", lat: 45.6195, lng: -121.5242, url: "https://hiyuwinefarm.com", address: "4555 Belmont Dr, Hood River, OR 97031", phone: "" },
                    { name: "Hood Crest Winery & Distillers", lat: 45.6764, lng: -121.5120, url: "https://hoodcrestwinery.com", address: "1900 Orchard Rd, Hood River, OR 97031", phone: "" },
                    { name: "Hood River Vineyards & Winery", lat: 45.6933, lng: -121.5311, url: "https://hoodrivervineyardsandwinery.com", address: "4693 Westwood Dr, Hood River, OR 97031", phone: "" },
                    { name: "Jacob Williams Winery", lat: 45.6791, lng: -121.0108, url: "", address: "10 Balch Rd, Lyle, WA 98635", phone: "" },
                    { name: "Le Doubbl√© Troubbl√© Wine Co.", lat: 45.7277, lng: -121.4855, url: "", address: "3636 Post Canyon Dr, Hood River, OR 97031", phone: "" },
                    { name: "Loop de Loop Wines", lat: 45.7282, lng: -121.5257, url: "", address: "4080 Barrett Dr, Hood River, OR 97031", phone: "" },
                    { name: "Marchesi Vineyards", lat: 45.6934, lng: -121.5370, url: "https://www.marchesivineyards.com", address: "3955 Belmont Dr, Hood River, OR 97031", phone: "" },
                    { name: "Maryhill Winery (Goldendale)", lat: 45.7081, lng: -120.8158, url: "https://maryhillwinery.com", address: "9774 Hwy 14, Goldendale, WA 98620", phone: "" },
                    { name: "Memaloose Wines", lat: 45.6933, lng: -121.2955, url: "", address: "40 Lyle-Snowden Rd, Lyle, WA 98635", phone: "" },
                    { name: "Mt. Hood Winery", lat: 45.6546, lng: -121.5102, url: "https://mthoodwinery.com", address: "2882 Van Horn Dr, Hood River, OR 97031", phone: "541-386-8333" },
                    { name: "Phelps Creek Vineyards", lat: 45.7061, lng: -121.5627, url: "https://phelpscreekvineyards.com", address: "1850 Country Club Rd, Hood River, OR 97031", phone: "" },
                    { name: "Savage Grace Wines", lat: 45.7252, lng: -121.5328, url: "https://savagegracewines.com", address: "70 Little Buck Creek Rd, Underwood, WA 98651", phone: "" },
                    { name: "South Hill Vineyards & Winery", lat: 45.7291, lng: -121.5230, url: "https://southhillvineyards.com", address: "101 Reservoir Rd, Hood River, OR 97031", phone: "" },
                    { name: "Stave & Stone Winery", lat: 45.7089, lng: -121.5214, url: "https://staveandstone.com", address: "3827 Fletcher Dr, Hood River, OR 97031", phone: "" },
                    { name: "Syncline Winery", lat: 45.6958, lng: -121.2958, url: "https://synclinewine.com", address: "111 Balch Rd, Lyle, WA 98635", phone: "" },
                    { name: "Tetrahedron Wines", lat: 45.6892, lng: -121.2988, url: "https://www.tetrahedronwines.com", address: "151 Old Highway 8, Lyle, WA 98635", phone: "" },
                    { name: "The Pines 1852", lat: 45.7080, lng: -121.5120, url: "https://www.thepinesvineyard.com", address: "202 Cascade Ave, Hood River, OR 97031", phone: "" },
                    { name: "Viento Wines", lat: 45.6820, lng: -121.5200, url: "https://vientowines.com", address: "301 Country Club Rd, Hood River, OR 97031", phone: "" },
                    { name: "Waving Tree Winery", lat: 45.7050, lng: -120.8142, url: "https://wavingtreewine.com", address: "9900 Hwy 14, Goldendale, WA 98620", phone: "" },
                    { name: "Wy'East Vineyards", lat: 45.6008, lng: -121.6004, url: "https://wyeastvineyards.com", address: "3189 Hwy 35, Hood River, OR 97031", phone: "" },
                ];

                const bounds = new google.maps.LatLngBounds();
                let openInfoWindow = null;
                let markersCreated = 0;

                wineries.forEach((winery, index) => {
                    try {
                        if (google.maps.marker && google.maps.marker.AdvancedMarkerElement) {
                            const icon = document.createElement("img");
                            icon.src = "https://raw.githubusercontent.com/twitter/twemoji/master/assets/svg/1f377.svg";
                            icon.classList.add("wine-icon");
                            
                            const marker = new google.maps.marker.AdvancedMarkerElement({
                                map,
                                position: { lat: winery.lat, lng: winery.lng },
                                title: winery.name,
                                content: icon,
                            });

                            const mapsUrl = getMapUrl(winery.address, winery.name);
                            
                            let infoContent = `<div class="info-window">
                                <div style="font-weight: 600; font-size: 14px; color: #333; margin-bottom: 4px;">${winery.name}</div>`;
                            
                            if (winery.phone) {
                                infoContent += `<a href="tel:${winery.phone}" style="color: #0066cc; text-decoration: none; font-size: 12px; display: block; line-height: 1.3; margin-bottom: 2px;">
                                    üìû ${winery.phone}
                                </a>`;
                            }
                            
                            if (winery.address) {
                                infoContent += `<a href="${mapsUrl}" target="_blank" rel="noopener" style="color: #0066cc; text-decoration: none; font-size: 12px; display: block; line-height: 1.3; margin-bottom: 2px;">
                                    üìç ${winery.address}
                                </a>`;
                            }
                            
                            if (winery.url) {
                                infoContent += `<a href="${winery.url}" target="_blank" rel="noopener" style="color: #0066cc; text-decoration: none; font-size: 12px; line-height: 1.3;">
                                    üåê Visit Website
                                </a>`;
                            }
                            
                            infoContent += `</div>`;
                            
                            const infoWindow = new google.maps.InfoWindow({
                                content: infoContent,
                                pixelOffset: new google.maps.Size(0, -10)
                            });

                            marker.addListener("click", () => {
                                if (openInfoWindow) {
                                    openInfoWindow.close();
                                }
                                infoWindow.open(map, marker);
                                openInfoWindow = infoWindow;
                            });

                            bounds.extend(marker.position);
                            markersCreated++;
                        } else {
                            const marker = new google.maps.Marker({
                                map,
                                position: { lat: winery.lat, lng: winery.lng },
                                title: winery.name,
                                icon: {
                                    url: "https://raw.githubusercontent.com/twitter/twemoji/master/assets/svg/1f377.svg",
                                    scaledSize: new google.maps.Size(28, 28),
                                    origin: new google.maps.Point(0, 0),
                                    anchor: new google.maps.Point(14, 14)
                                },
                                animation: google.maps.Animation.DROP
                            });

                            const mapsUrl = getMapUrl(winery.address, winery.name);
                            
                            let infoContent = `<div class="info-window">
                                <div style="font-weight: 600; font-size: 14px; color: #333; margin-bottom: 4px;">${winery.name}</div>`;
                            
                            if (winery.phone) {
                                infoContent += `<a href="tel:${winery.phone}" style="color: #0066cc; text-decoration: none; font-size: 12px; display: block; line-height: 1.3; margin-bottom: 2px;">
                                    üìû ${winery.phone}
                                </a>`;
                            }
                            
                            if (winery.address) {
                                infoContent += `<a href="${mapsUrl}" target="_blank" rel="noopener" style="color: #0066cc; text-decoration: none; font-size: 12px; display: block; line-height: 1.3; margin-bottom: 2px;">
                                    üìç ${winery.address}
                                </a>`;
                            }
                            
                            if (winery.url) {
                                infoContent += `<a href="${winery.url}" target="_blank" rel="noopener" style="color: #0066cc; text-decoration: none; font-size: 12px; line-height: 1.3;">
                                    üåê Visit Website
                                </a>`;
                            }
                            
                            infoContent += `</div>`;
                            
                            const infoWindow = new google.maps.InfoWindow({
                                content: infoContent
                            });

                            marker.addListener("click", () => {
                                if (openInfoWindow) {
                                    openInfoWindow.close();
                                }
                                infoWindow.open(map, marker);
                                openInfoWindow = infoWindow;
                            });

                            bounds.extend(marker.position);
                            markersCreated++;
                        }
                    } catch (markerError) {
                        console.error(`Failed to create marker for ${winery.name}:`, markerError);
                    }
                });

                console.log(`Created ${markersCreated} of ${wineries.length} markers`);

                map.fitBounds(bounds);

                google.maps.event.addListenerOnce(map, "idle", function() {
                    if (map.getZoom() < 10.8) {
                        map.setZoom(10.8);
                    }
                    if (map.getZoom() > 13) {
                        map.setZoom(13);
                    }
                });

                const resetButton = document.createElement("button");
                resetButton.textContent = "üîÑ Reset View";
                resetButton.style.cssText = `
                    background: white;
                    border: 2px solid #fff;
                    border-radius: 3px;
                    box-shadow: 0 2px 6px rgba(0,0,0,.3);
                    color: rgb(25,25,25);
                    cursor: pointer;
                    font-family: 'Montserrat', sans-serif;
                    font-size: 14px;
                    margin: 10px;
                    padding: 8px 12px;
                    text-align: center;
                    transition: background 0.2s;
                `;
                
                resetButton.addEventListener("mouseover", () => {
                    resetButton.style.background = "#f5f5f5";
                });
                
                resetButton.addEventListener("mouseout", () => {
                    resetButton.style.background = "white";
                });
                
                resetButton.addEventListener("click", () => {
                    map.fitBounds(bounds);
                    
                    setTimeout(() => {
                        const currentZoom = map.getZoom();
                        if (currentZoom < 10.8) {
                            map.setZoom(10.8);
                        }
                        if (currentZoom > 13) {
                            map.setZoom(13);
                        }
                    }, 100);
                    
                    if (openInfoWindow) {
                        openInfoWindow.close();
                        openInfoWindow = null;
                    }
                });
                
                map.controls[google.maps.ControlPosition.TOP_RIGHT].push(resetButton);

                map.addListener("click", () => {
                    if (openInfoWindow) {
                        openInfoWindow.close();
                        openInfoWindow = null;
                    }
                });

            } catch (error) {
                console.error('Map initialization failed:', error);
                document.getElementById('map').innerHTML = 
                    '<div class="error-message">Map could not be loaded. Please check your connection and try again.</div>';
            }
        }

        window.gm_authFailure = function() {
            document.getElementById('map').innerHTML = 
                '<div class="error-message">Google Maps authentication failed. Please check API key configuration.</div>';
        };
    </script>
    
    <script 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBD8JvHV2ALs6AbnHom5SjJQQ6cC0v-g7A&callback=initMap&loading=async&libraries=marker&v=weekly"
        onerror="document.getElementById('map').innerHTML = '<div class=\'error-message\'>Failed to load Google Maps. Please try again later.</div>';">
    </script>
</body>
</html>
