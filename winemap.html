<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Columbia River Gorge Wineries Map</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Montserrat', sans-serif;
        }
        
        #map {
            height: 100%;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
        }
        
        .loading-message, .error-message {
            text-align: center;
            padding: 20px;
            color: #696969;
            font-size: 16px;
        }
        
        .error-message {
            color: #d32f2f;
        }
        
        .gm-style-iw {
            font-family: 'Montserrat', sans-serif !important;
        }
        
        .info-window {
            padding: 4px 6px;
            font-size: 14px;
            line-height: 1.3;
            min-width: 180px;
        }
        
        .info-window a {
            color: #0066cc;
            text-decoration: none;
            display: block;
            padding: 1px 0;
        }
        
        .info-window a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="map">
        <div class="loading-message">Loading map...</div>
    </div>

    <script>
        let mapTimeout = setTimeout(function() {
            if (!window.google) {
                document.getElementById('map').innerHTML = 
                    '<div class="error-message">Map is taking too long to load. Please refresh the page.</div>';
            }
        }, 10000);

        function isAppleDevice() {
            return /iPhone|iPad|iPod|Macintosh/.test(navigator.userAgent);
        }

        function getMapUrl(address, name) {
            var query = encodeURIComponent(address || name);
            if (isAppleDevice()) {
                return 'https://maps.apple.com/?q=' + query;
            } else {
                return 'https://www.google.com/maps/search/?api=1&query=' + query;
            }
        }

        function formatPhoneDisplay(phone) {
            var cleaned = phone.replace(/\D/g, '');
            if (cleaned.length === 10) {
                return '(' + cleaned.slice(0,3) + ') ' + cleaned.slice(3,6) + '-' + cleaned.slice(6);
            } else if (cleaned.length === 11 && cleaned[0] === '1') {
                return '+1 (' + cleaned.slice(1,4) + ') ' + cleaned.slice(4,7) + '-' + cleaned.slice(7);
            }
            return phone;
        }

        function initMap() {
            try {
                clearTimeout(mapTimeout);
                document.getElementById('map').innerHTML = '';
                
                var map = new google.maps.Map(document.getElementById("map"), {
                    center: { lat: 45.7, lng: -121.5 },
                    zoom: 11,
                    gestureHandling: "greedy",
                    scrollwheel: true,
                    zoomControl: true,
                    fullscreenControl: false,
                    mapTypeControl: false,
                    streetViewControl: false,
                    clickableIcons: false,
                    styles: [
                        {
                            featureType: "poi",
                            elementType: "labels",
                            stylers: [{ visibility: "off" }]
                        },
                        {
                            featureType: "transit",
                            elementType: "labels",
                            stylers: [{ visibility: "off" }]
                        }
                    ]
                });

                var wineries = [
                    { name: "Analemma Wines", lat: 45.6841, lng: -121.4037, url: "https://analemmawines.com", address: "1710 1st St, Mosier, OR 97040", phone: "541-478-2873" },
                    { name: "AniChe Cellars", lat: 45.7283, lng: -121.5349, url: "https://anichecellars.com", address: "71 Little Buck Creek Rd, Underwood, WA 98651", phone: "360-624-6531" },
                    { name: "Cascade Cliffs Vineyard & Winery", lat: 45.6795, lng: -121.5215, url: "https://cascadecliffs.com", address: "211 Oak St, Hood River, OR 97031", phone: "541-436-4215" },
                    { name: "Cathedral Ridge Winery", lat: 45.7156, lng: -121.5450, url: "https://cathedralridgewinery.com", address: "4200 Post Canyon Dr, Hood River, OR 97031", phone: "800-516-8710" },
                    { name: "COR Cellars", lat: 45.6889, lng: -121.3033, url: "https://www.corcellars.com", address: "151 Old Highway 8, Lyle, WA 98635", phone: "509-365-2744" },
                    { name: "Double Strand Wine", lat: 45.6733, lng: -121.4065, url: "https://doublestrandwine.com", address: "953 Quartz Dr, Mosier, OR 97040", phone: "" },
                    { name: "Estelbrook Farms & Vineyard", lat: 45.7259, lng: -121.4840, url: "https://www.estelbrook.com", address: "3640 Post Canyon Dr, Hood River, OR 97031", phone: "" },
                    { name: "Hawkins Cellars", lat: 45.7290, lng: -121.5358, url: "https://hawkinscellars.com", address: "92 Little Buck Creek Rd, Underwood, WA 98651", phone: "" },
                    { name: "Hiyu Wine Farm", lat: 45.6195, lng: -121.5242, url: "https://hiyuwinefarm.com", address: "4555 Belmont Dr, Hood River, OR 97031", phone: "" },
                    { name: "Hood Crest Winery & Distillers", lat: 45.6764, lng: -121.5120, url: "https://hoodcrestwinery.com", address: "1900 Orchard Rd, Hood River, OR 97031", phone: "" },
                    { name: "Hood River Vineyards & Winery", lat: 45.6933, lng: -121.5311, url: "https://hoodrivervineyardsandwinery.com", address: "4693 Westwood Dr, Hood River, OR 97031", phone: "" },
                    { name: "Jacob Williams Winery", lat: 45.6791, lng: -121.0108, url: "", address: "10 Balch Rd, Lyle, WA 98635", phone: "" },
                    { name: "Le Doubbl√© Troubbl√© Wine Co.", lat: 45.7277, lng: -121.4855, url: "", address: "3636 Post Canyon Dr, Hood River, OR 97031", phone: "" },
                    { name: "Loop de Loop Wines", lat: 45.7282, lng: -121.5257, url: "", address: "4080 Barrett Dr, Hood River, OR 97031", phone: "" },
                    { name: "Marchesi Vineyards", lat: 45.6934, lng: -121.5370, url: "https://www.marchesivineyards.com", address: "3955 Belmont Dr, Hood River, OR 97031", phone: "" },
                    { name: "Maryhill Winery (Goldendale)", lat: 45.7081, lng: -120.8158, url: "https://maryhillwinery.com", address: "9774 Hwy 14, Goldendale, WA 98620", phone: "" },
                    { name: "Memaloose Wines", lat: 45.6933, lng: -121.2955, url: "", address: "40 Lyle-Snowden Rd, Lyle, WA 98635", phone: "" },
                    { name: "Mt. Hood Winery", lat: 45.6546, lng: -121.5102, url: "https://mthoodwinery.com", address: "2882 Van Horn Dr, Hood River, OR 97031", phone: "541-386-8333" },
                    { name: "Phelps Creek Vineyards", lat: 45.7061, lng: -121.5627, url: "https://phelpscreekvineyards.com", address: "1850 Country Club Rd, Hood River, OR 97031", phone: "" },
                    { name: "Savage Grace Wines", lat: 45.7252, lng: -121.5328, url: "https://savagegracewines.com", address: "70 Little Buck Creek Rd, Underwood, WA 98651", phone: "" },
                    { name: "South Hill Vineyards & Winery", lat: 45.7291, lng: -121.5230, url: "https://southhillvineyards.com", address: "101 Reservoir Rd, Hood River, OR 97031", phone: "" },
                    { name: "Stave & Stone Winery", lat: 45.7089, lng: -121.5214, url: "https://staveandstone.com", address: "3827 Fletcher Dr, Hood River, OR 97031", phone: "" },
                    { name: "Syncline Winery", lat: 45.6958, lng: -121.2958, url: "https://synclinewine.com", address: "111 Balch Rd, Lyle, WA 98635", phone: "" },
                    { name: "Tetrahedron Wines", lat: 45.6892, lng: -121.2988, url: "https://www.tetrahedronwines.com", address: "151 Old Highway 8, Lyle, WA 98635", phone: "" },
                    { name: "The Pines 1852", lat: 45.7080, lng: -121.5120, url: "https://www.thepinesvineyard.com", address: "202 Cascade Ave, Hood River, OR 97031", phone: "" },
                    { name: "Viento Wines", lat: 45.6820, lng: -121.5200, url: "https://vientowines.com", address: "301 Country Club Rd, Hood River, OR 97031", phone: "" },
                    { name: "Waving Tree Winery", lat: 45.7050, lng: -120.8142, url: "https://wavingtreewine.com", address: "9900 Hwy 14, Goldendale, WA 98620", phone: "" },
                    { name: "Wy'East Vineyards", lat: 45.6008, lng: -121.6004, url: "https://wyeastvineyards.com", address: "3189 Hwy 35, Hood River, OR 97031", phone: "" },
                ];

                var bounds = new google.maps.LatLngBounds();
                var openInfoWindow = null;

                // Create wine glass SVG as a proper base64 encoded data URL
                var wineGlassSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 36 36">' +
                    '<path fill="#722F37" d="M30.935 14.813c0 6.906-4.399 12.78-10.538 14.953v3.234h4c.553 0 1 .447 1 1s-.447 1-1 1h-12c-.553 0-1-.447-1-1s.447-1 1-1h4v-3.234C9.856 27.594 5.457 21.72 5.457 14.813c0-.828.672-1.5 1.5-1.5h22.478c.828 0 1.5.672 1.5 1.5z"/>' +
                    '<path fill="#8B4049" d="M28.435 13.313H7.957c-.828 0-1.5.672-1.5 1.5 0 5.719 3.019 10.709 7.539 13.5h8.4c4.52-2.791 7.539-7.781 7.539-13.5 0-.828-.672-1.5-1.5-1.5z"/>' +
                    '<ellipse fill="#9B5563" cx="18.196" cy="4" rx="13.5" ry="4"/>' +
                    '<path fill="#722F37" d="M29.696 6.5c0 2.209-5.149 4-11.5 4s-11.5-1.791-11.5-4c0-.441.253-.859.696-1.232C8.764 4.321 13.027 3.5 18.196 3.5s9.432.821 10.804 1.768c.443.373.696.791.696 1.232z"/>' +
                    '</svg>';
                
                var wineGlassIcon = 'data:image/svg+xml;base64,' + btoa(wineGlassSvg);

                for (var i = 0; i < wineries.length; i++) {
                    (function(winery) {
                        var marker = new google.maps.Marker({
                            map: map,
                            position: { lat: winery.lat, lng: winery.lng },
                            title: winery.name,
                            icon: {
                                url: wineGlassIcon,
                                scaledSize: new google.maps.Size(32, 32),
                                anchor: new google.maps.Point(16, 32)
                            }
                        });

                        var mapsUrl = getMapUrl(winery.address, winery.name);
                        
                        var infoHTML = '<div class="info-window">';
                        infoHTML += '<div style="font-weight: 600; font-size: 14px; color: #333; margin-bottom: 4px;">' + winery.name + '</div>';
                        
                        if (winery.phone && winery.phone !== "") {
                            infoHTML += '<a href="tel:' + winery.phone + '" style="color: #0066cc; text-decoration: none; font-size: 12px; display: block; line-height: 1.3; margin-bottom: 2px;">üìû ' + formatPhoneDisplay(winery.phone) + '</a>';
                        }
                        
                        if (winery.address) {
                            infoHTML += '<a href="' + mapsUrl + '" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: none; font-size: 12px; display: block; line-height: 1.3; margin-bottom: 2px;">üìç ' + winery.address + '</a>';
                        }
                        
                        if (winery.url) {
                            infoHTML += '<a href="' + winery.url + '" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: none; font-size: 12px; line-height: 1.3;">üåê Visit Website</a>';
                        }
                        
                        infoHTML += '</div>';
                        
                        var infoWindow = new google.maps.InfoWindow({
                            content: infoHTML
                        });

                        marker.addListener("click", function() {
                            if (openInfoWindow) {
                                openInfoWindow.close();
                            }
                            infoWindow.open(map, marker);
                            openInfoWindow = infoWindow;
                        });

                        bounds.extend(marker.position);
                    })(wineries[i]);
                }

                map.fitBounds(bounds);

                google.maps.event.addListenerOnce(map, "idle", function() {
                    var currentZoom = map.getZoom();
                    if (currentZoom < 10.8) {
                        map.setZoom(10.8);
                    }
                    if (currentZoom > 13) {
                        map.setZoom(13);
                    }
                });

                var resetButton = document.createElement("button");
                resetButton.textContent = "üîÑ Reset View";
                resetButton.style.cssText = 'background: white; border: 2px solid #fff; border-radius: 3px; box-shadow: 0 2px 6px rgba(0,0,0,.3); color: rgb(25,25,25); cursor: pointer; font-family: Montserrat, sans-serif; font-size: 14px; margin: 10px; padding: 8px 12px;';
                
                resetButton.addEventListener("click", function() {
                    map.fitBounds(bounds);
                    setTimeout(function() {
                        var currentZoom = map.getZoom();
                        if (currentZoom < 10.8) map.setZoom(10.8);
                        if (currentZoom > 13) map.setZoom(13);
                    }, 100);
                    if (openInfoWindow) {
                        openInfoWindow.close();
                        openInfoWindow = null;
                    }
                });
                
                map.controls[google.maps.ControlPosition.TOP_RIGHT].push(resetButton);

            } catch (error) {
                console.error('Map error:', error);
                document.getElementById('map').innerHTML = 
                    '<div class="error-message">Map could not be loaded. Please refresh.</div>';
            }
        }

        window.gm_authFailure = function() {
            clearTimeout(mapTimeout);
            document.getElementById('map').innerHTML = 
                '<div class="error-message">Google Maps authentication failed.</div>';
        };
    </script>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBD8JvHV2ALs6AbnHom5SjJQQ6cC0v-g7A&callback=initMap" async defer></script>
</body>
</html>
