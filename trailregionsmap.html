<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Columbia River Gorge — Regions Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      color: #333;
      background: #fff;
      overflow: hidden;
    }
    body {
      display: flex;
      flex-direction: row;
      width: 100%;
      height: 100%;
    }
    #map {
      flex: 1 1 auto;
      width: 100%;
      height: 100%;
      border: 1px solid #ddd;
      box-sizing: border-box;
      position: relative;
    }
    .map-title {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 1000;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 8px 14px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .legend {
      flex: 0 0 320px;
      height: 100%;
      background: #fff;
      border-left: 1px solid #ddd;
      box-shadow: -2px 0 8px rgba(0,0,0,.1);
      padding: 0 16px 16px 16px;
      box-sizing: border-box;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .legend h3 {
      margin: 0;
      padding: 8px 0 0 0;
      font-size: 16px;
      font-weight: 600;
      line-height: 1;
    }
    .row {
      display: grid;
      grid-template-columns: 20px 1fr;
      gap: 8px;
      padding: 8px 0;
      align-items: start;
    }
    .swatch {
      width: 20px;
      height: 20px;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,.15);
      cursor: pointer;
      transition: transform 0.15s ease;
    }
    .swatch:hover { transform: scale(1.1); }
    .name { font-weight: 600; font-size: 14px; cursor: pointer; transition: color 0.2s; }
    .meta { font-size: 12px; color: #555; margin-top: 2px; line-height: 1.3; }
    .name.active { color: #111; text-decoration: underline; }
    .swatch.active { box-shadow: 0 0 0 2px #0002, 0 0 6px rgba(0,0,0,0.3); }
    .popup h4 { margin: 0 0 6px; font-size: 15px; }
    .popup .small { font-size: 12px; color: #555; margin-bottom: 6px; }
    .trail-list { font-size: 13px; margin-top: 4px; }
    .trail-list div { padding: 2px 0; border-bottom: 1px solid #eee; }
    @media (max-width:900px){
      body { flex-direction: column; height: auto; }
      #map { height: 70vh; width: 100%; }
      .legend { border-left: none; border-top: 1px solid #ddd; box-shadow: none; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="map-title">Columbia River Gorge — Region Bands3</div>
  <div class="legend" id="legend"></div>

  <script>
    // region data shortened for readability
    const regions = [
      {name:"West",color:"#3b82f6",exits:"Up to Exit 28",area:"Portland metro → Bridal Veil",lngMin:-122.50,lngMax:-122.18,
       trails:["Angels Rest to Devil’s Rest","Angels' Rest","Bridal Veil Falls","Bridal Veil Loop","Gillette Lake","Latourell Falls Trail","Rooster Rock Loop","Sandy River Delta","Shepperd's Dell","Steigerwald Lake Trail"]},
      {name:"Central West",color:"#22c55e",exits:"Exit 28–40/44",area:"Bridal Veil → Bonneville/Cascade Locks",lngMin:-122.18,lngMax:-121.94,
       trails:["Bell Creek Trail","Bonneville Dam Trail","Fairy Falls","Horsetail Falls Loop","John B. Yeon Trailhead","Lancaster Falls","Larch Mt via Multnomah Falls","Lower Starvation Loop","Multnomah Falls","Multnomah–Wahkeena Loop","Nesmith Point Trail","Oneonta Gorge","Ponytail Falls Trail","Pool Of The Winds","Punchbowl Falls","Triple Falls Trail","Upper McCord Creek Falls","Wahkeena Falls"]},
      {name:"Central",color:"#f59e0b",exits:"Exit 40–44",area:"Cascade Locks / Bonneville Dam",lngMin:-121.94,lngMax:-121.83,
       trails:["Augspurger Mountain Trail","Beacon Rock Trail","Bridge Of The Gods Trailhead","Cape Horn Loop Trail","Cascade Locks Trail","Dry Creek Falls","Eagle Creek Trail","Elowah Falls","Hamilton Mountain Loop","Hardy Ridge Loop","Indian Point Loop","Mark O. Hatfield Trailhead","Munra Point","Nick Eaton Ridge Loop","Ruckel Ridge Loop","Starvation Ridge","Table Mountain Loop","Tooth Rock Loop","Tunnel Falls","Wahclella Falls","Wauna Point"]}
    ];

    const map = L.map('map',{scrollWheelZoom:true,zoomControl:false}).setView([45.68,-121.9],9.2);
    L.control.zoom({position:'bottomright'}).addTo(map);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18,attribution:'&copy; OpenStreetMap'}).addTo(map);

    function bandPolygon(lngMin,lngMax,latMin=45.48,latMax=45.77){
      return [[latMin,lngMin],[latMin,lngMax],[latMax,lngMax],[latMax,lngMin]];
    }

    const group = L.layerGroup().addTo(map);
    let activeRegion = null;

    regions.forEach(r=>{
      const poly = L.polygon(bandPolygon(r.lngMin,r.lngMax),{
        color:r.color,weight:2,fillColor:r.color,fillOpacity:0.18
      })
      .on('mouseover',()=>poly.setStyle({fillOpacity:0.3,weight:3}))
      .on('mouseout',()=>{ if(activeRegion!==r) poly.setStyle({fillOpacity:0.18,weight:2}); })
      .bindPopup(`
        <div class="popup">
          <h4>${r.name}</h4>
          <div class="small"><strong>Area:</strong> ${r.area}</div>
          <div class="small"><strong>Exits:</strong> ${r.exits}</div>
          <div class="small"><strong>Trails</strong></div>
          <div class="trail-list">${r.trails.map(t=>`<div>${t}</div>`).join('')}</div>
        </div>
      `);
      poly.addTo(group);
      r.layer = poly;
    });

    const legend = document.getElementById('legend');
    legend.innerHTML = `
      <h3>Region Guide</h3>
      ${regions.map((r,i)=>`
        <div class="row">
          <div class="swatch" data-index="${i}" style="background:${r.color}20;border-color:${r.color}55"></div>
          <div>
            <div class="name" data-index="${i}">${r.name}</div>
            <div class="meta"><strong>Area:</strong> ${r.area}</div>
            <div class="meta"><strong>Exits:</strong> ${r.exits}</div>
          </div>
        </div>`).join('')}
    `;

    function handleRegionClick(i){
      const region=regions[i];
      const nameEl=document.querySelector(`.name[data-index="${i}"]`);
      const swatchEl=document.querySelector(`.swatch[data-index="${i}"]`);

      if(activeRegion===region){
        region.layer.setStyle({weight:2,fillOpacity:0.18});
        nameEl.classList.remove('active');
        swatchEl.classList.remove('active');
        activeRegion=null;
        map.closePopup();
        return;
      }

      regions.forEach(r=>r.layer.setStyle({weight:2,fillOpacity:0.18}));
      document.querySelectorAll('.name').forEach(n=>n.classList.remove('active'));
      document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('active'));

      region.layer.setStyle({weight:5,fillOpacity:0.35});
      nameEl.classList.add('active');
      swatchEl.classList.add('active');
      activeRegion=region;

      region.layer.openPopup();

      // ✅ Wait for popup, then pan to vertically center popup box
      setTimeout(()=>{
        const popupEl=document.querySelector('.leaflet-popup');
        if(!popupEl) return;
        const rect=popupEl.getBoundingClientRect();
        const mapRect=map.getContainer().getBoundingClientRect();
        const popupCenterY=rect.top+rect.height/2;
        const mapCenterY=mapRect.top+mapRect.height/2;
        const offsetY=popupCenterY-mapCenterY;
        map.panBy([0,offsetY],{animate:true});
      },200);
    }

    document.querySelectorAll('.legend .name, .legend .swatch').forEach(el=>{
      el.addEventListener('click',()=>{
        const i=parseInt(el.getAttribute('data-index'));
        handleRegionClick(i);
      });
    });
  </script>
</body>
</html>
