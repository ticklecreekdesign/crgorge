<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Columbia River Gorge Regions</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Source Sans 3', sans-serif; background: #1a1a1a; color: #f5f5f0; }
        header {
            background: linear-gradient(135deg, #2d4a3e 0%, #1a2f26 100%);
            padding: 1.5rem 2rem;
            border-bottom: 3px solid #5d8a6b;
        }
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            color: #f5f5f0;
        }
        .subtitle { color: #a8c4b0; font-size: 1rem; margin-top: 0.25rem; }
        #map { height: 100vh; width: 100%; }
        .region-label-wrapper {
            background: transparent !important;
            border: none !important;
            transform: translate(-50%, -50%);
        }
        .legend {
            background: rgba(26, 26, 26, 0.95);
            padding: 1rem 1.25rem;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            border: 1px solid #3a3a3a;
            max-width: 180px;
        }
        .legend h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: #f5f5f0;
            border-bottom: 1px solid #3a3a3a;
            padding-bottom: 0.5rem;
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 0.5rem; font-size: 0.85rem; }
        .legend-color {
            width: 24px;
            height: 18px;
            margin-right: 0.6rem;
            border-radius: 3px;
            border: 1px solid rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        const map = L.map('map', {
            center: [45.62, -121.6],
            zoom: 10,
            zoomControl: true
        });

        // Esri World Topo basemap
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri'
        }).addTo(map);

        // Region colors - earthy tones
        const colors = {
            west: '#1B5E20',
            centralWest: '#2E7D32',
            central: '#558B2F',
            centralEast: '#9E9D24',
            east: '#C0CA33'
        };

        // Oregon boundary points (1-6)
        const OR = [
            [45.542793, -122.357188],  // 1
            [45.594439, -122.069067],  // 2
            [45.693033, -121.788757],  // 3
            [45.708906, -121.490056],  // 4
            [45.607299, -121.197596],  // 5
            [45.635525, -120.911525]   // 6
        ];

        // Washington boundary points (1-6)
        const WA = [
            [45.57168228259249, -122.31767443196766],   // 1
            [45.59242347354461, -122.07760326175781],   // 2
            [45.61316466449673, -121.83753209154797],   // 3
            [45.63390585544885, -121.59746092133812],   // 4
            [45.65464704640097, -121.35738975112828],   // 5
            [45.67538823737303, -120.87730858090842]    // 6
        ];

        // Regions defined by their left and right boundary indices
        const regions = [
            { name: 'West', color: colors.west, leftOR: OR[0], rightOR: OR[1], leftWA: WA[0], rightWA: WA[1] },
            { name: 'Central West', color: colors.centralWest, leftOR: OR[1], rightOR: OR[2], leftWA: WA[1], rightWA: WA[2] },
            { name: 'Central', color: colors.central, leftOR: OR[2], rightOR: OR[3], leftWA: WA[2], rightWA: WA[3] },
            { name: 'Central East', color: colors.centralEast, leftOR: OR[3], rightOR: OR[4], leftWA: WA[3], rightWA: WA[4] },
            { name: 'East', color: colors.east, leftOR: OR[4], rightOR: OR[5], leftWA: WA[4], rightWA: WA[5] }
        ];

        // Fade settings
        const fadeSteps = 15;
        const fadeExtension = 0.15; // How far north/south to extend fades
        const baseOpacity = 0.35;

        // Draw each region
        regions.forEach(region => {
            // Use average longitude for straight vertical boundaries (matching the lines)
            const leftLng = (region.leftOR[1] + region.leftWA[1]) / 2;
            const rightLng = (region.rightOR[1] + region.rightWA[1]) / 2;
            
            // Find the north and south extents for the main fill
            const northLat = Math.max(region.leftWA[0], region.rightWA[0], region.leftOR[0], region.rightOR[0]);
            const southLat = Math.min(region.leftWA[0], region.rightWA[0], region.leftOR[0], region.rightOR[0]);

            // Draw the main fill as a simple rectangle with straight vertical sides
            L.polygon([
                [southLat, leftLng],
                [southLat, rightLng],
                [northLat, rightLng],
                [northLat, leftLng]
            ], {
                color: 'transparent',
                weight: 0,
                fillColor: region.color,
                fillOpacity: baseOpacity
            }).addTo(map);

            // Draw fade bands extending NORTH
            for (let i = 1; i <= fadeSteps; i++) {
                const fadeStart = northLat + (fadeExtension / fadeSteps) * (i - 1);
                const fadeEnd = northLat + (fadeExtension / fadeSteps) * i;
                const opacity = baseOpacity * (1 - i / fadeSteps);
                
                L.polygon([
                    [fadeStart, leftLng],
                    [fadeStart, rightLng],
                    [fadeEnd, rightLng],
                    [fadeEnd, leftLng]
                ], {
                    color: 'transparent',
                    weight: 0,
                    fillColor: region.color,
                    fillOpacity: opacity
                }).addTo(map);
            }

            // Draw fade bands extending SOUTH
            for (let i = 1; i <= fadeSteps; i++) {
                const fadeStart = southLat - (fadeExtension / fadeSteps) * (i - 1);
                const fadeEnd = southLat - (fadeExtension / fadeSteps) * i;
                const opacity = baseOpacity * (1 - i / fadeSteps);
                
                L.polygon([
                    [fadeStart, leftLng],
                    [fadeStart, rightLng],
                    [fadeEnd, rightLng],
                    [fadeEnd, leftLng]
                ], {
                    color: 'transparent',
                    weight: 0,
                    fillColor: region.color,
                    fillOpacity: opacity
                }).addTo(map);
            }

            // Draw straight vertical boundary lines (north-south)
            const lineSteps = 20;
            const verticalExtent = 0.25; // How far north and south the lines extend
            
            // Use average of OR and WA latitudes as center point
            const leftCenterLat = (region.leftOR[0] + region.leftWA[0]) / 2;
            const rightCenterLat = (region.rightOR[0] + region.rightWA[0]) / 2;
            
            // Left vertical line (uses leftLng already defined above)
            for (let i = 0; i < lineSteps; i++) {
                const t1 = i / lineSteps;
                const t2 = (i + 1) / lineSteps;
                
                const lat1 = (leftCenterLat - verticalExtent) + t1 * (verticalExtent * 2);
                const lat2 = (leftCenterLat - verticalExtent) + t2 * (verticalExtent * 2);
                
                // Opacity fades at top and bottom
                const dist1 = Math.abs(lat1 - leftCenterLat);
                const dist2 = Math.abs(lat2 - leftCenterLat);
                const avgDist = (dist1 + dist2) / 2;
                const opacity = Math.max(0.1, 1 - (avgDist / verticalExtent) * 0.9);
                
                L.polyline([[lat1, leftLng], [lat2, leftLng]], {
                    color: '#888888',
                    weight: 2,
                    opacity: opacity
                }).addTo(map);
            }
            
            // Right vertical line (uses rightLng already defined above)
            for (let i = 0; i < lineSteps; i++) {
                const t1 = i / lineSteps;
                const t2 = (i + 1) / lineSteps;
                
                const lat1 = (rightCenterLat - verticalExtent) + t1 * (verticalExtent * 2);
                const lat2 = (rightCenterLat - verticalExtent) + t2 * (verticalExtent * 2);
                
                const dist1 = Math.abs(lat1 - rightCenterLat);
                const dist2 = Math.abs(lat2 - rightCenterLat);
                const avgDist = (dist1 + dist2) / 2;
                const opacity = Math.max(0.1, 1 - (avgDist / verticalExtent) * 0.9);
                
                L.polyline([[lat1, rightLng], [lat2, rightLng]], {
                    color: '#888888',
                    weight: 2,
                    opacity: opacity
                }).addTo(map);
            }
            
            // Add region name label in the center of the visible region
            // Use the same center points as the vertical lines (already calculated above)
            const centerLat = (leftCenterLat + rightCenterLat) / 2;
            const centerLng = (leftLng + rightLng) / 2;
            
            const label = L.divIcon({
                className: 'region-label-wrapper',
                html: `<div style="
                    color: #333;
                    font-family: 'Source Sans 3', sans-serif;
                    font-size: 14px;
                    font-weight: 600;
                    white-space: nowrap;
                    text-shadow: 1px 1px 2px white, -1px -1px 2px white, 1px -1px 2px white, -1px 1px 2px white;
                    position: absolute;
                    left: 50%;
                    top: 50%;
                    transform: translate(-50%, -50%);
                ">${region.name}</div>`,
                iconSize: [100, 40],
                iconAnchor: [50, 20]
            });
            
            L.marker([centerLat, centerLng], { icon: label, interactive: false }).addTo(map);
        });
    </script>
</body>
</html>
