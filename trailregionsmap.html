<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Columbia River Gorge â€” Regions Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts & Leaflet -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      color: #333;
      background: #fff;
      overflow: hidden;
    }

    body {
      display: flex;
      flex-direction: row;
      width: 100%;
      height: 100%;
    }

    /* âœ… Map & legend flex layout */
    #map {
      flex: 1 1 auto;
      width: 100%;
      height: 100%;
      border: 1px solid #ddd;
      box-sizing: border-box;
      position: relative;
    }

    .map-title {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 1000;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 8px 14px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .leaflet-bottom.leaflet-right {
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .legend {
      flex: 0 0 320px;
      height: 100%;
      background: #fff;
      border-left: 1px solid #ddd;
      box-shadow: -2px 0 8px rgba(0,0,0,.1);
      padding: 0 16px 16px 16px;
      box-sizing: border-box;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    /* âœ… Title styling (no underline, with top padding) */
    .legend h3 {
      margin: 0;
      padding: 8px 0 0 0;
      font-size: 16px;
      font-weight: 600;
      line-height: 1;
    }

    .row {
      display: grid;
      grid-template-columns: 20px 1fr;
      gap: 8px;
      padding: 8px 0;
      align-items: center;
    }
    .swatch {
      width: 20px;
      height: 20px;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,.15);
      cursor: pointer;
      transition: transform 0.15s ease;
    }
    .swatch:hover { transform: scale(1.1); }

    .name { font-weight: 600; font-size: 14px; cursor: pointer; transition: color 0.2s; }
    .meta { font-size: 12px; color: #555; margin-top: 2px; line-height: 1.3; }
    .chips { margin-top: 4px; display: flex; flex-wrap: wrap; gap: 4px; }
    .chip { font-size: 11px; padding: 3px 6px; border-radius: 999px; background: #f2f2f2; border: 1px solid #ddd; }

    /* Highlighted legend name */
    .name.active { color: #111; text-decoration: underline; }
    .swatch.active { box-shadow: 0 0 0 2px #0002, 0 0 6px rgba(0,0,0,0.3); }

    .popup h4 { margin: 0 0 6px; font-size: 15px; }
    .popup .small { font-size: 12px; color: #555; }

    @media (max-width: 900px) {
      body { flex-direction: column; height: auto; }
      #map { height: 70vh; width: 100%; }
      .legend {
        flex: 0 0 auto;
        height: auto;
        border-left: none;
        border-top: 1px solid #ddd;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="map-title">Columbia River Gorge â€” Region Bands</div>
  <div class="legend" id="legend"></div>

  <script>
    // âœ… Dynamically size map for Hostinger container
    function resizeMapToParent() {
      const parent = document.body.parentElement || document.documentElement;
      const h = parent.clientHeight || window.innerHeight;
      document.body.style.height = h + 'px';
      document.getElementById('map').style.height = h + 'px';
    }
    window.addEventListener('load', resizeMapToParent);
    window.addEventListener('resize', resizeMapToParent);

    const map = L.map('map', {
      scrollWheelZoom: true,
      zoomControl: false
    }).setView([45.68, -121.9], 11.8); // ðŸ‘ˆ Default zoom here

    L.control.zoom({ position: 'bottomright' }).addTo(map);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    function bandPolygon(lngMin, lngMax, latMin = 45.48, latMax = 45.77) {
      return [
        [latMin, lngMin],
        [latMin, lngMax],
        [latMax, lngMax],
        [latMax, lngMin]
      ];
    }

    const regions = [
      {name:'West', color:'#3b82f6', exits:'Up to Exit 28', area:'Portland metro â†’ Bridal Veil',
       lngMin:-122.50, lngMax:-122.18, markers:['Troutdale','Corbett','Crown Point']},
      {name:'Central West', color:'#22c55e', exits:'Exit 28â€“40/44', area:'Bridal Veil â†’ Bonneville/Cascade Locks',
       lngMin:-122.18, lngMax:-121.94, markers:['Multnomah Falls','Wahkeena Falls','Horsetail Falls','Oneonta Gorge']},
      {name:'Central', color:'#f59e0b', exits:'Exit 40â€“44', area:'Cascade Locks / Bonneville Dam',
       lngMin:-121.94, lngMax:-121.83, markers:['Bridge of the Gods','Eagle Creek','Cascade Locks','Stevenson (WA)']},
      {name:'Central East', color:'#ef4444', exits:'Exit 44â€“69', area:'Cascade Locks â†’ Mosier',
       lngMin:-121.83, lngMax:-121.45, markers:['Hood River','Starvation Creek','Mosier Twin Tunnels']},
      {name:'East', color:'#a855f7', exits:'Exit 69+', area:'Mosier â†’ The Dalles / Lyle (WA)',
       lngMin:-121.45, lngMax:-121.1, markers:['Rowena Crest','Tom McCall Point','The Dalles','Lyle (WA)']}
    ];

    const group = L.layerGroup().addTo(map);

    // âœ… Create polygons and attach to regions
    regions.forEach(r => {
      const poly = L.polygon(bandPolygon(r.lngMin, r.lngMax), {
        color: r.color,
        weight: 2,
        fillColor: r.color,
        fillOpacity: 0.18
      })
      .on('mouseover', () => poly.setStyle({ fillOpacity: 0.3, weight: 3 }))
      .on('mouseout', () => {
        if (activeRegion !== r)
          poly.setStyle({ fillOpacity: 0.18, weight: 2 });
      })
      .bindPopup(`
        <div class="popup">
          <h4>${r.name}</h4>
          <div class="small"><strong>Area:</strong> ${r.area}</div>
          <div class="small"><strong>Exits:</strong> ${r.exits}</div>
          <div class="chips">${r.markers.map(m => `<span class="chip">${m}</span>`).join('')}</div>
        </div>
      `);
      poly.addTo(group);
      r.layer = poly;
    });

    const bounds = L.latLngBounds([[45.48, -122.5], [45.78, -121.1]]);
    map.setMaxBounds(bounds.pad(0.02));

    // âœ… Build legend
    const legend = document.getElementById('legend');
    legend.innerHTML = `
      <h3>Region Guide</h3>
      ${regions.map(r => `
        <div class="row">
          <div class="swatch" data-index="${regions.indexOf(r)}" style="background:${r.color}20;border-color:${r.color}55"></div>
          <div>
            <div class="name" data-index="${regions.indexOf(r)}">${r.name}</div>
            <div class="meta"><strong>Area:</strong> ${r.area}</div>
            <div class="meta"><strong>Exits:</strong> ${r.exits}</div>
            <div class="chips">${r.markers.map(m => `<span class="chip">${m}</span>`).join('')}</div>
          </div>
        </div>
      `).join('')}
    `;

    // âœ… Interactive highlighting for both name and swatch
    let activeRegion = null;

    function handleRegionClick(i) {
      const region = regions[i];
      const nameEl = document.querySelector(`.name[data-index="${i}"]`);
      const swatchEl = document.querySelector(`.swatch[data-index="${i}"]`);

      // If clicking the same region again â†’ unhighlight
      if (activeRegion === region) {
        region.layer.setStyle({ weight: 2, fillOpacity: 0.18 });
        nameEl.classList.remove('active');
        swatchEl.classList.remove('active');
        activeRegion = null;
        return;
      }

      // Reset all
      regions.forEach(r => r.layer.setStyle({ weight: 2, fillOpacity: 0.18 }));
      document.querySelectorAll('.legend .name').forEach(n => n.classList.remove('active'));
      document.querySelectorAll('.legend .swatch').forEach(s => s.classList.remove('active'));

      // Highlight this one
      region.layer.setStyle({ weight: 5, fillOpacity: 0.35 });
      nameEl.classList.add('active');
      swatchEl.classList.add('active');
      activeRegion = region;

      // Center and zoom to it
      map.fitBounds(region.layer.getBounds(), { maxZoom: 12.5, animate: true });
    }

    document.querySelectorAll('.legend .name, .legend .swatch').forEach(el => {
      el.addEventListener('click', () => {
        const i = parseInt(el.getAttribute('data-index'));
        handleRegionClick(i);
      });
    });
  </script>
</body>
</html>
